---
- name: Ensure Docker-related python packages are present
  pip: name=docker

- name: Ensure the config directory is present
  file: path=/opt/mozilla_syncserver state=directory mode=0755 owner=1001 group=1001

- name: Define the default docker container volumes
  set_fact:
    _mozilla_syncserver_docker_volumes:
      - "/opt/mozilla_syncserver:/data"

- name: Append any additional volume mounts
  set_fact:
    _mozilla_syncserver_docker_volumes: "{{ _mozilla_syncserver_docker_volumes }} + {{ mozilla_syncserver_additional_volumes }}"

- name: ensure mozilla syncserver is started
  docker_container:
    name: mozilla-syncserver
    image: "mozilla/syncserver:{{ mozilla_syncserver_docker_version }}"
    state: started
    restart_policy: always
    timeout: 300
    exposed_ports:
      - "{{ mozilla_syncserver_port }}" # sync endpoint
    volumes: "{{ _mozilla_syncserver_docker_volumes }}"
    env: "{{ mozilla_syncserver_environment_variables }}"
